#!/usr/bin/env bash
set -euo pipefail

# get command from first argument (addhost or vmsmenu)
cmd="${1:-}"
shift || true

# validate that we have a supported command
if [[ "$cmd" != "addhost" && "$cmd" != "vmsmenu" ]]; then
	echo "Error: launcher requires 'addhost' or 'vmsmenu' as first argument" >&2
	exit 1
fi

# convert MSYS paths to windows paths for windows python
win_home="$(cygpath -w "$HOME")"
msys2_usr_bin="$(cygpath -w /usr/bin)"

# add pylib to PYTHONPATH
export PYTHONPATH="$HOME/.local${PYTHONPATH:+:$PYTHONPATH}"

# run windows python with a USERPROFILE that points at the msys2 home for Path.home()
# and pass MSYS2_USR_BIN so Python can call MSYS2 ssh/telnet explicitly
exec env USERPROFILE="$win_home" MSYS2_USR_BIN="$msys2_usr_bin" \
	python -m pylib "$cmd" "$@"